<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Central Limit Theorem Demo — StatsLG</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style/bctcstyle.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <style>
    .wrap-grid{display:grid; grid-template-columns:320px 1fr; gap:15px; padding:10px;}
    .panel{background:white; padding:15px; border-radius:8px;}
    input[type="number"]{width:80px;}
  </style>
</head>

<body>
  <div class="wrap-grid">
    <!-- LEFT PANEL -->
    <div class="panel">
      <h2>Central Limit Theorem Demo</h2>

      <label for="distSelect"><strong>Population Distribution:</strong></label><br>
      <select id="distSelect">
        <option value="uniform">Uniform (0,1)</option>
        <option value="normal">Normal (μ=0, σ=1)</option>
        <option value="skewed">Right-Skewed (Exp)</option>
        <option value="bimodal">Bimodal</option>
        <option value="crazy">Crazy (Sinusoidal)</option>
      </select>

      <br><br>

      <label><strong>Sample Size (n):</strong></label><br>
      <input type="number" id="sampleSize" value="30" min="1" max="500">

      <br><br>

      <button id="takeSampleBtn">Take ONE Sample</button><br><br>
      <button id="take50Btn">Take 50 Samples</button><br><br>
      <button id="resetBtn">Reset</button>

      <hr>
      <p><strong>Population Mean (μ):</strong> <span id="popMean"></span></p>
      <p><strong>Population SD (σ):</strong> <span id="popSD"></span></p>
      <p><strong># of Sample Means Collected:</strong> <span id="countSamples">0</span></p>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel">
      <h3>Population Distribution</h3>
      <canvas id="populationChart"></canvas>

      <h3>Sampling Distribution of Sample Means</h3>
      <canvas id="samplingChart"></canvas>
    </div>
  </div>

  <!-- Sidebar Injection -->
  <script>
    fetch("/partials/sidebar.html")
      .then(r => r.text())
      .then(html => { document.body.insertAdjacentHTML("afterbegin", html); });
  </script>

  <script>
    // GLOBALS
    let population = [];
    let sampleMeans = [];
    const POP_SIZE = 20000;

    // CHARTS
    const popCtx = document.getElementById("populationChart");
    const sampCtx = document.getElementById("samplingChart");

    function makeChart(ctx, data, label) {
      return new Chart(ctx, {
        type: "bar",
        data: { labels: data.x, datasets: [{ data: data.y }] },
        options: {
          scales:{ y:{ beginAtZero:true }},
          plugins:{ legend:{ display:false }},
        }
      });
    }

    function histogram(values, bins=40){
      const min = Math.min(...values), max = Math.max(...values);
      const width=(max-min)/bins;
      let counts=new Array(bins).fill(0);
      values.forEach(v=>{ counts[Math.min(bins-1, Math.floor((v-min)/width))]++; });
      return {x:counts.map((_,i)=> (min+i*width).toFixed(2)), y:counts};
    }

    function generatePopulation(dist){
      if(dist==="uniform") return Array.from({length:POP_SIZE},()=>Math.random());
      if(dist==="normal") return Array.from({length:POP_SIZE},()=>Math.random()*1+0);
      if(dist==="skewed") return Array.from({length:POP_SIZE},()=>Math.random()*-Math.log(Math.random()));
      if(dist==="bimodal") return Array.from({length:POP_SIZE},()=>Math.random()<0.5?Math.random()*0.5:Math.random()*0.5+1.5);
      if(dist==="crazy") return Array.from({length:POP_SIZE},()=>Math.sin(Math.random()*10)+Math.random()*0.5);
    }

    function mean(arr){return arr.reduce((a,b)=>a+b,0)/arr.length;}
    function sd(arr){
      let m=mean(arr);
      return Math.sqrt(mean(arr.map(v=>(v-m)**2)));
    }

    let popChart, sampChart;

    function refreshPopulation(){
      const dist=document.getElementById("distSelect").value;
      population=generatePopulation(dist);
      document.getElementById("popMean").textContent = mean(population).toFixed(4);
      document.getElementById("popSD").textContent = sd(population).toFixed(4);

      const hist=histogram(population);
      if(popChart) popChart.destroy();
      popChart = makeChart(popCtx, hist, "Population");
    }

    function takeSample(){
      let n=parseInt(document.getElementById("sampleSize").value);
      let sample=[];
      for(let i=0;i<n;i++){
        sample.push(population[Math.floor(Math.random()*POP_SIZE)]);
      }
      sampleMeans.push(mean(sample));
      document.getElementById("countSamples").textContent=sampleMeans.length;
      updateSamplingChart();
    }

    function updateSamplingChart(){
      const hist=histogram(sampleMeans);
      if(sampChart) sampChart.destroy();
      sampChart = makeChart(sampCtx, hist, "Sampling Distribution");
    }

    document.getElementById("takeSampleBtn").onclick=takeSample;
    document.getElementById("take50Btn").onclick=()=>{for(let i=0;i<50;i++)takeSample();};
    document.getElementById("resetBtn").onclick=()=>{sampleMeans=[]; document.getElementById("countSamples").textContent=0; updateSamplingChart();};
    document.getElementById("distSelect").onchange=refreshPopulation;

    refreshPopulation();
    updateSamplingChart();
  </script>
</body>
</html>
