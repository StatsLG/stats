<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Central Limit Theorem Demo — StatsLG</title>
  <link rel="stylesheet" href="/style/bctcstyle.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .wrap { display: flex; padding: 20px; }
    .controls { width: 300px; padding-right: 25px; }
  </style>
</head>

<body>

<div id="sidebar-container"></div>
<script>
  fetch("/partials/sidebar.html")
    .then(r => r.text())
    .then(t => document.getElementById("sidebar-container").innerHTML = t);
</script>

<div class="wrap">
  
  <!-- CONTROL PANEL -->
  <div class="controls">
    <h2>Central Limit Theorem Demo</h2>

    <label><b>Statistic Type</b></label><br>
    <select id="statType">
      <option value="mean">Sample Mean (x̄)</option>
      <option value="prop">Sample Proportion (p̂)</option>
    </select>
    <br><br>

    <label><b>Population Distribution</b></label><br>
    <select id="popType">
      <option value="normal">Normal (mean=50, sd=10)</option>
      <option value="uniform">Uniform (0 to 100)</option>
      <option value="skew">Right-Skewed (Gamma-like)</option>
      <option value="bern">Bernoulli (success probability p)</option>
    </select>
    <br><br>

    <label id="pLabel" style="display:none;"><b>p (for Bernoulli)</b></label>
    <input type="range" id="pSlider" min="0" max="1" step="0.01" value="0.5" style="display:none;">
    <span id="pVal" style="display:none;">0.50</span>
    <br><br>

    <label><b>Sample Size (n)</b></label><br>
    <input type="range" id="nSlider" min="2" max="100" step="1" value="30">
    <span id="nVal">30</span>
    <br><br>

    <button id="drawBtn">Draw Sample</button>
    <button id="resetBtn">Reset</button>
  </div>

  <!-- HISTOGRAM -->
  <div style="flex-grow:1;">
    <canvas id="histCanvas"></canvas>
  </div>

</div>

<script>
let results = [];

const histCtx = document.getElementById("histCanvas").getContext("2d");
let histChart = new Chart(histCtx, {
  type: 'bar',
  data: { labels: [], datasets: [{ data: [] }] },
  options: { animation: false }
});

function randNormal(mu=50, sigma=10){
  let u1 = Math.random(), u2 = Math.random();
  return mu + sigma * Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);
}
function randSkew(){
  return Math.abs(randNormal(0,1)) * 20;
}
function drawSample(){
  const n = parseInt(nSlider.value);
  const statType = statTypeSel.value;
  const popType = popTypeSel.value;

  let sample = [];

  for(let i=0;i<n;i++){
    if(popType === "normal") sample.push(randNormal());
    else if(popType === "uniform") sample.push(Math.random()*100);
    else if(popType === "skew") sample.push(randSkew());
    else if(popType === "bern") sample.push(Math.random() < parseFloat(pSlider.value) ? 1 : 0);
  }

  let stat;
  if(statType === "mean"){
    stat = sample.reduce((a,b)=>a+b)/n;
  } else {
    stat = sample.filter(x=>x===1).length / n;
  }

  results.push(stat);
  updateHist();
}

function updateHist(){
  let bins = 20;
  let min = Math.min(...results);
  let max = Math.max(...results);
  let step = (max-min)/bins;

  let counts = new Array(bins).fill(0);
  results.forEach(v=>{
    let idx = Math.min(bins-1, Math.floor((v-min)/step));
    counts[idx]++;
  });

  histChart.data.labels = counts.map((_,i)=> (min+i*step).toFixed(2));
  histChart.data.datasets[0].data = counts;
  histChart.update();
}

drawBtn.onclick = drawSample;
resetBtn.onclick = ()=>{ results=[]; updateHist(); };

const statTypeSel = document.getElementById("statType");
const popTypeSel = document.getElementById("popType");
const nSlider = document.getElementById("nSlider");
const nVal = document.getElementById("nVal");
const pSlider = document.getElementById("pSlider");
const pVal = document.getElementById("pVal");
const pLabel = document.getElementById("pLabel");

nSlider.oninput = ()=> nVal.textContent = nSlider.value;
pSlider.oninput = ()=> pVal.textContent = pSlider.value;

popTypeSel.onchange = ()=>{
  let show = popTypeSel.value === "bern";
  pSlider.style.display = pVal.style.display = pLabel.style.display = show ? "inline" : "none";
};
</script>

</body>
</html>
