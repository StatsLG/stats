<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monty Hall ‚Äî Game (StatsLG)</title>
  <!-- Brand CSS -->
  <link rel="stylesheet" href="../style/bctcstyle.css" />
  <style>
    :root{
      --kctcs-blue:#00467f; --kctcs-gold:#e7a614;
      --bg:#ffffff; --ink:#0f172a; --muted:#6b7280; --panel:#f3f4f6; --rule:#e5e7eb;
      --win:#22c55e; --lose:#ef4444; --accent:#2563eb;
    }
    html,body{height:100%}
    body{margin:0; color:var(--ink); background:var(--bg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
    .layout{display:grid; grid-template-columns: 280px 1fr; min-height:100vh}
    #sidebar{background:var(--kctcs-blue); color:#fff}
    #sidebar .sidebar-inner{position:sticky; top:0; min-height:100vh; padding:1rem}
    main{padding:1.25rem; background:linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)}

    .page-title{display:flex; align-items:center; gap:.75rem; margin:0 0 1rem}
    .badge{display:inline-block; padding:.15rem .5rem; font-size:.8rem; border-radius:999px; background:var(--kctcs-gold); color:#1f2937; font-weight:600}

    .card{background:#fff; border:1px solid var(--rule); border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.05)}
    .card .hd{padding:1rem 1.25rem; border-bottom:1px solid var(--rule); font-weight:700}
    .card .bd{padding:1rem 1.25rem}

    .game-grid{display:block}

    /* Doors */
    .doors{display:grid; grid-template-columns: repeat(3, 1fr); gap:1rem; margin:1rem 0}
    .door{position:relative; aspect-ratio: 3/5; border-radius:18px; overflow:hidden; cursor:pointer; user-select:none; border:2px solid #0b3b65; background:linear-gradient(145deg, #0f4e86, #09365a); box-shadow: inset 0 2px 8px rgba(255,255,255,.12), 0 8px 20px rgba(0,0,0,.15); transition: transform .12s ease, box-shadow .2s ease}
    .door:hover{transform: translateY(-2px)}
    .door.disabled{opacity:.55; cursor:not-allowed; filter:saturate(.6)}
    .door .panel{position:absolute; inset:0; transform-origin: left center; background:linear-gradient(145deg, #155fa3, #0d3f6a); transition: transform .6s cubic-bezier(.2,.8,.2,1); box-shadow: inset -8px 0 20px rgba(0,0,0,.25)}
    .door.revealed .panel{animation: doorOpen .7s cubic-bezier(.2,.8,.2,1) forwards}
@keyframes doorOpen{
  0%{ transform: perspective(900px) rotateY(0deg) }
  70%{ transform: perspective(900px) rotateY(-100deg) }
  100%{ transform: perspective(900px) rotateY(-92deg) }
}
    .door .label{position:absolute; left:0; right:0; top:.5rem; text-align:center; color:#dbeafe; font-weight:800; letter-spacing:.5px}
    .door .knob{position:absolute; right:.6rem; bottom:45%; width:.65rem; height:.65rem; border-radius:50%; background:#f59e0b; box-shadow:0 0 0 3px rgba(0,0,0,.15)}
    .behind{position:absolute; inset:0; display:grid; place-items:center;}
.behind .prize{max-width:90%; max-height:90%; object-fit:contain; filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));}
.behind .goat{ }
.behind .car{ }
    .behind .goat{color:#9ca3af}
    .behind .car{color:#16a34a}

    /* Controls */
    .controls{display:flex; flex-wrap:wrap; gap:.5rem}
    .btn{appearance:none; border:1px solid var(--rule); background:#fff; color:var(--ink); padding:.6rem .9rem; border-radius:10px; font-weight:600; cursor:pointer; transition:transform .06s ease, box-shadow .15s ease}
    .btn.primary{background:var(--kctcs-blue); color:#fff; border-color:#07375e}
    .btn.warn{background:#fff7ed; color:#7c2d12; border-color:#fed7aa}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn:active{transform: scale(0.98)}
    .btn.pulse{box-shadow:0 0 0 4px rgba(37,99,235,.15)}

    .status{display:flex; flex-wrap:wrap; gap:.75rem; align-items:center; margin:.5rem 0 0}
    .status .chip{background:#eef2ff; color:#1e3a8a; padding:.25rem .5rem; border-radius:999px; font-size:.82rem; border:1px solid #c7d2fe}

    .results{max-width: 680px; margin-top:1rem}
    .table{width:100%; border-collapse: collapse; font-size:.95rem}
    .table th,.table td{padding:.5rem .6rem; border-bottom:1px solid var(--rule); text-align:left}
    .table th{font-weight:700; background:#f8fafc}

    @media (max-width: 1100px){
      .layout{grid-template-columns: 1fr}
      #sidebar{min-height:auto}
    }

    /* Win/Lose highlight */
    .door.winning{box-shadow:0 0 0 4px rgba(34,197,94,.35), 0 18px 40px rgba(34,197,94,.35); transform: translateY(-2px) scale(1.02)}
    .door.losing{box-shadow:0 0 0 4px rgba(239,68,68,.25), 0 10px 24px rgba(239,68,68,.25)}
      #sidebar{min-height:auto}
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside id="sidebar"><div class="sidebar-inner">
      <div id="sidebar-slot">Loading menu‚Ä¶</div>
    </div></aside>

    <main>
      <h1 class="page-title">Monty Hall <span class="badge">Game</span></h1>
      <p>Pick a door. The host will reveal a goat behind one of the other doors. Then choose to <strong>switch</strong> or <strong>stay</strong>. See how your choices turn out over time.</p>
      <ol style="margin-top:-.25rem; margin-bottom:1rem;">
        <li>What is the probability of picking the car?</li>
        <li>After one of the doors has been revealed to be a goat, should you stay or switch?</li>
        <li>Does it matter?</li>
      </ol>

      <div class="card" style="margin:.5rem 0 1rem; max-width:900px">
        <div class="hd">Scenario &amp; Process</div>
        <div class="bd">
          <p style="margin-top:0">You are on a game show with <strong>three closed doors</strong>. Behind one door is a car; behind the other two are goats. Your goal is to pick the car.</p>
          <ul style="margin:.4rem 0 .6rem 1.25rem">
            <li><strong>Setup:</strong> The car is hidden uniformly at random behind one of the three doors. The host <em>knows</em> where the car is.</li>
            <li><strong>Step 1 ‚Äî You pick a door.</strong> You do <em>not</em> open it yet.</li>
            <li><strong>Step 2 ‚Äî Host reveals a goat</strong> behind one of the <em>other</em> doors. The host will never open your chosen door and will never reveal the car.</li>
            <li><strong>Step 3 ‚Äî Decision:</strong> You may <em>stay</em> with your original door or <em>switch</em> to the other unopened door.</li>
            <li><strong>Outcome:</strong> Both remaining closed doors are resolved and you see whether you won the car.</li>
          </ul>
          <p style="margin:0; color:var(--muted); font-size:.95rem"><strong>Play tip:</strong> Try several rounds using both strategies. Use the table at the bottom to track wins and losses for <em>Stay</em> vs <em>Switch</em>.</p>
        </div>
      </div>

      <section class="game-grid" id="game">
        <div class="card">
          <div class="hd">Game</div>
          <div class="bd">
            <div class="controls" style="margin-bottom:.5rem">
              <button id="resetRound" class="btn">Reset Round</button>
              <button id="resetAll" class="btn warn">Reset Stats</button>
              <div style="flex:1"></div>
              <button id="simulate10Stay" class="btn" title="Auto-play 10 rounds staying">Play 10 (Stay)</button>
              <button id="simulate10Switch" class="btn primary" title="Auto-play 10 rounds switching">Play 10 (Switch)</button>
            </div>

            <div id="phaseMsg" class="status"><span class="chip">Phase: Choose a door</span></div>
            <div class="doors" id="doors"></div>
            <div class="controls">
              <button id="btnStay" class="btn" disabled>Stay</button>
              <button id="btnSwitch" class="btn primary" disabled>Switch</button>
              <button id="btnNext" class="btn ghost" disabled>Next Round</button>
            </div>
          </div>
        </div>

        <div class="card results">
          <div class="hd">Results by Strategy</div>
          <div class="bd">
            <table class="table">
              <thead>
                <tr><th></th><th>Wins</th><th>Losses</th><th>Win %</th></tr>
              </thead>
              <tbody>
                <tr><th>Switch</th><td id="swW">0</td><td id="swL">0</td><td id="swP">0%</td></tr>
                <tr><th>Stay</th><td id="stW">0</td><td id="stL">0</td><td id="stP">0%</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
  // Inject sidebar
  fetch('../partials/sidebar.html').then(r=>r.text()).then(html=>{
    document.getElementById('sidebar-slot').innerHTML = html;
  }).catch(()=>{
    document.getElementById('sidebar-slot').innerHTML = '<h3 style="margin:0 0 .5rem">StatsLG</h3><p><em>Sidebar failed to load.</em></p>'
  });

  // Helpers: button pulse feedback
  function pulse(el){
    if(!el) return;
    el.classList.add('pulse');
    setTimeout(()=> el.classList.remove('pulse'), 250);
  }

  // Elements
  const doorsEl = document.getElementById('doors');
  const phaseMsg = document.getElementById('phaseMsg');
  const btnStay = document.getElementById('btnStay');
  const btnSwitch = document.getElementById('btnSwitch');
  const btnNext = document.getElementById('btnNext');
  const btnResetRound = document.getElementById('resetRound');
  const btnResetAll = document.getElementById('resetAll');
  const btnSim10Stay = document.getElementById('simulate10Stay');
  const btnSim10Switch = document.getElementById('simulate10Switch');

  const swW = document.getElementById('swW');
  const swL = document.getElementById('swL');
  const stW = document.getElementById('stW');
  const stL = document.getElementById('stL');
  const swP = document.getElementById('swP');
  const stP = document.getElementById('stP');

  // Image assets (update paths if needed)
  const CAR_SRC = 'newcar.png'; // place next to this html or adjust path
  const GOAT_SRC = 'goat.png';

  // Game state
  const PHASE = { PICK: 'pick', REVEAL: 'reveal', DECIDE: 'decide', FINISH: 'finish' };
  let state;
  let stats = { total:0, reveals:0, switchW:0, switchL:0, stayW:0, stayL:0 };

  function initRound(){
    state = {
      phase: PHASE.PICK,
      prize: Math.floor(Math.random()*3),
      pick: null,
      revealed: null,
      finalChoice: null
    };
    phaseMsg.innerHTML = '<span class="chip">Phase: Choose a door</span>';
    renderDoors();
    btnStay.disabled = true; btnSwitch.disabled = true; btnNext.disabled = true;
  }

  function doorTemplate(i){
    const isPicked = state.pick === i;
    const isRevealed = state.revealed === i;
    const isDisabled = (state.phase === PHASE.REVEAL || state.phase === PHASE.DECIDE || state.phase === PHASE.FINISH);
    const behind = (isRevealed || state.phase === PHASE.FINISH)
      ? (i===state.prize ? `<img class=\"prize car\" src=\"${CAR_SRC}\" alt=\"car\">` : `<img class=\"prize goat\" src=\"${GOAT_SRC}\" alt=\"goat\">`)
      : '';
    return `
      <button class="door ${isRevealed?'revealed':''} ${isDisabled && !isPicked ? 'disabled':''}" data-door="${i}" aria-label="Door ${i+1}">
        <div class="panel"></div>
        <div class="label">Door ${i+1}${isPicked?' ‚Ä¢ Your pick':''}</div>
        <div class="knob"></div>
        <div class="behind">${behind}</div>
      </button>
    `;
  }

  function renderDoors(){
    doorsEl.innerHTML = [0,1,2].map(doorTemplate).join('');
    [...doorsEl.querySelectorAll('.door')].forEach(btn=>{
      btn.addEventListener('click', onDoorClick);
    });
  }

  function onDoorClick(e){
    const d = Number(e.currentTarget.getAttribute('data-door'));
    if(state.phase===PHASE.PICK){
      state.pick = d;
      phaseMsg.innerHTML = '<span class="chip">Phase: Host reveals a goat‚Ä¶</span>';
      const candidates = [0,1,2].filter(x => x!==state.pick && x!==state.prize);
      state.revealed = candidates[Math.floor(Math.random()*candidates.length)];
      stats.reveals++;
      state.phase = PHASE.DECIDE;
      renderDoors();
      btnStay.disabled = false; btnSwitch.disabled = false; btnNext.disabled = true;
    }
  }

  function finishRound(finalChoice){
    state.finalChoice = finalChoice;
    state.phase = PHASE.FINISH;
    renderDoors();
    const win = (finalChoice === state.prize);
    if(finalChoice === state.pick){
      if(win) stats.stayW++; else stats.stayL++;
    } else {
      if(win) stats.switchW++; else stats.switchL++;
    }
    stats.total++;
    updateStats();
    phaseMsg.innerHTML = `<span class="chip" style="background:${win?'#dcfce7':'#fee2e2'}; color:${win?'#166534':'#991b1b'}">Result: ${win?'You WON! üöó':'You lost üêê'}</span>`;
    btnStay.disabled = true; btnSwitch.disabled = true; btnNext.disabled = false;

    // highlight the final door briefly
    const dEl = doorsEl.querySelector(`[data-door="${finalChoice}"]`);
    if(dEl){
      dEl.classList.add(win? 'winning' : 'losing');
      setTimeout(()=> dEl.classList.remove('winning','losing'), 900);
    }
  }

  function updateStats(){
    // Update results-by-strategy table
    swW.textContent = stats.switchW;
    swL.textContent = stats.switchL;
    stW.textContent = stats.stayW;
    stL.textContent = stats.stayL;
    const swT = stats.switchW + stats.switchL;
    const stT = stats.stayW + stats.stayL;
    const swPct = swT ? Math.round((stats.switchW / swT) * 100) : 0;
    const stPct = stT ? Math.round((stats.stayW / stT) * 100) : 0;
    swP.textContent = swPct + '%';
    stP.textContent = stPct + '%';
  }

  function simulate(n, policy){
    // policy: 'stay' | 'switch'
    for(let i=0;i<n;i++){
      const prize = Math.floor(Math.random()*3);
      const pick = Math.floor(Math.random()*3);
      const candidates = [0,1,2].filter(x => x!==pick && x!==prize);
      const revealed = candidates[Math.floor(Math.random()*candidates.length)];
      const finalChoice = (policy==='switch') ? [0,1,2].find(x=>x!==pick && x!==revealed) : pick;
      const win = (finalChoice===prize);
      if(policy==='switch') { if(win) stats.switchW++; else stats.switchL++; }
      else { if(win) stats.stayW++; else stats.stayL++; }
      stats.total++;
      stats.reveals++;
    }
    updateStats();
  }

  // Button handlers (with pulse feedback)
  btnStay.addEventListener('click', ()=>{ pulse(btnStay); finishRound(state.pick); });
  btnSwitch.addEventListener('click', ()=>{
    pulse(btnSwitch);
    const otherClosed = [0,1,2].find(x => x!==state.pick && x!==state.revealed);
    finishRound(otherClosed);
  });
  btnNext.addEventListener('click', ()=> { pulse(btnNext); initRound(); });
  btnResetRound.addEventListener('click', ()=> { pulse(btnResetRound); initRound(); });
  btnResetAll.addEventListener('click', ()=>{
    pulse(btnResetAll);
    stats = { total:0, reveals:0, switchW:0, switchL:0, stayW:0, stayL:0 };
    updateStats();
    initRound();
  });
  btnSim10Stay.addEventListener('click', ()=> { pulse(btnSim10Stay); simulate(10,'stay'); });
  btnSim10Switch.addEventListener('click', ()=> { pulse(btnSim10Switch); simulate(10,'switch'); });

  // --- Smoke tests (console) ---
  function selfTest(){
    console.group('MontyHall selfTest');
    // doors render
    console.assert(doorsEl.children.length===3, 'Expected 3 doors rendered');
    // simulate updates counts without errors
    const pre = {swW:stats.switchW, stW:stats.stayW};
    simulate(5,'switch'); simulate(5,'stay');
    console.assert(stats.switchW >= pre.swW && stats.stayW >= pre.stW, 'Expected simulation to increment win counters (may be 0 increments due to randomness)');
    console.groupEnd();
  }

  // Boot
  updateStats();
  initRound();
  // Run a light self-test after first render
  setTimeout(selfTest, 0);
  </script>
</body>
</html>
