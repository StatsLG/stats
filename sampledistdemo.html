<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STA220 — Sampling Distribution Applet (n=3)</title>
  <meta name="description" content="Applet to visualize a sampling distribution from a population of 10, all samples of size 3." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style/bctcstyle.css">

  <!-- MathJax for a couple formulas -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true
      },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <style>
    /* Tiny helpers for visuals */
    .chart {
      width: 100%;
      height: 340px;
      border: 1px solid var(--rule);
      border-radius: var(--radius);
      background: #fff;
      display: block;
    }
    .mini { font-size: 12px; color: var(--muted); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .statgrid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px }
    .nums { display:grid; grid-template-columns: repeat(5, 1fr); gap:8px }
    .nums input { width:100%; text-align:center }
    .scroll { max-height: 320px; overflow: auto; background:#fff; border:1px solid var(--rule); border-radius:8px; }
    .nowrap { white-space: nowrap; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ===== LEFT PANEL (BRAND SIDEBAR) ===== -->
    <aside class="sidebar" aria-label="Site navigation">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div class="brand-title">BCTC Statistics Hub</div>
      </div>

      <div class="nav-section">
        <h3>Graphing</h3>
        <nav class="nav">
          <a href="/graphing/barchart.html">Bar Chart</a>
          <a href="/graphing/piechart.html">Pie / Donut</a>
          <a href="/graphing/histogram.html">Histogram</a>
          <a href="/graphing/boxplot.html">Box &amp; Whisker</a>
          <a href="/graphing/scatterplot.html">Scatter + Regression</a>
          <a href="/graphing/barchart2way.html">Grouped Bar</a>
        </nav>
      </div>

      <div class="divider" role="separator"></div>

      <div class="nav-section">
        <h3>Analysis</h3>
        <nav class="nav">
          <a href="/descriptive/summary.html">Descriptive Summary</a>
          <a href="/inference/onemean.html">One-Sample Mean Test</a>
        </nav>
      </div>

      <div class="divider" role="separator"></div>

      <div class="nav-section">
        <h3>Notes & Extras</h3>
        <nav class="nav">
          <a href="/STA210U/">STA 210U</a>
          <a href="/STA220/">STA 220</a>
          <a href="/STA296U/">STA 296U</a>
          <a href="/game/pathyfinder.html">Pathy Finder</a>
        </nav>
      </div>

      <div class="footer-note">
        © <span id="yr"></span> StatsLG - Luke Garnett
      </div>
    </aside>

    <!-- ===== RIGHT PANEL (MAIN CONTENT) ===== -->
    <main>
      <header>
        <h1>Sampling Distribution Applet — \(N=10\), all samples of size \(n=3\)</h1>
        <p>Edit the population of 10 below, then compare the <strong>population distribution</strong> to the <strong>sampling distribution of \(\bar x\)</strong> over all \(\binom{10}{3}=120\) combinations (without replacement).</p>
      </header>

      <section class="section wrap" style="grid-template-columns: 360px 1fr;">
        <!-- ===== LEFT: Controls ===== -->
        <div class="panel pad left">
          <h2 style="margin-top:0;">Population (10 values)</h2>
          <p class="mini">Tip: values can repeat; decimals allowed.</p>
          <div class="nums" id="inputs"></div>

          <div class="row" style="margin-top:10px;">
            <button class="btn" id="btnUpdate">Update</button>
            <button class="btn outline" id="btnRandom">Randomize</button>
            <button class="btn ghost" id="btnEven">Evenly spaced</button>
            <button class="btn ghost" id="btnReset">Reset example</button>
          </div>

          <hr class="rule" style="margin:12px 0;">
          <div class="row">
            <div>
              <label>Sample size \(n\)</label>
              <input type="number" id="nInput" value="3" min="2" max="5" />
            </div>
            <div>
              <label>Bin width (means)</label>
              <input type="number" id="binWidth" value="0.5" step="0.1" />
            </div>
          </div>
        </div>

        <!-- ===== RIGHT: Charts & Stats ===== -->
        <div class="panel pad">
          <div class="statgrid">
            <div class="card">
              <h3 style="margin-top:0;">Population (N=<span id="N"></span>)</h3>
              <div class="mini">Values: <span id="popVals" class="mono"></span></div>
              <div class="mini">Mean \( \mu \): <span id="mu"></span></div>
              <div class="mini">SD \( \sigma \): <span id="sigma"></span></div>
            </div>
            <div class="card">
              <h3 style="margin-top:0;">Sampling Dist. of \( \bar x \) (all combos)</h3>
              <div class="mini">#Samples: <span id="numSamples"></span></div>
              <div class="mini">Empirical \( \mu_{\bar x} \): <span id="meanXbar"></span></div>
              <div class="mini">Empirical \( s_{\bar x} \): <span id="sdXbar"></span></div>
              <div class="mini">Theory \( \text{SE}=\frac{\sigma}{\sqrt{n}}\sqrt{\frac{N-n}{N-1}} \): <span id="seTheory"></span></div>
            </div>
          </div>

          <div class="grid" style="margin-top:12px;">
            <div class="card">
              <h3 style="margin-top:0;">Population Distribution (discrete)</h3>
              <svg id="popChart" class="chart" viewBox="0 0 640 340" aria-label="Population distribution chart"></svg>
            </div>
            <div class="card">
              <h3 style="margin-top:0;">Sampling Distribution of \( \bar x \) (n=<span id="nLabel">3</span>)</h3>
              <svg id="meanChart" class="chart" viewBox="0 0 640 340" aria-label="Sampling distribution chart"></svg>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== ALL SAMPLES TABLE ===== -->
      <section class="section">
        <h2>All samples (combinations) and their means</h2>
        <div class="row">
          <div>
            <label for="sortSelect">Sort</label>
            <select id="sortSelect">
              <option value="index">Index (1…k)</option>
              <option value="meanAsc">Mean ↑</option>
              <option value="meanDesc">Mean ↓</option>
            </select>
          </div>
          <div>
            <label for="findInput">Quick filter</label>
            <input id="findInput" type="text" placeholder="e.g., 26.1 or 4,6,7" />
          </div>
        </div>
        <div class="panel pad" style="margin-top:8px;">
          <div class="scroll">
            <table class="table" id="samplesTable" aria-label="All samples table">
              <thead>
                <tr>
                  <th class="nowrap">#</th>
                  <th>Indices</th>
                  <th>Sample values</th>
                  <th class="nowrap">x̄ (mean)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="mini" id="tableNote" style="margin-top:8px;"></p>
        </div>
      </section>

      <footer class="site-footer">
        Last updated: <span id="lastUpdated"></span>
      </footer>
    </main>
  </div>

  <script>
    // Footer bits
    document.getElementById('yr').textContent = new Date().getFullYear();
    document.getElementById('lastUpdated').textContent = new Date(document.lastModified).toLocaleString();

    // ===== Utilities =====
    const fmt = (x, d=3) => Number.isFinite(x) ? x.toFixed(d) : '—';
    const sum = a => a.reduce((s,v)=>s+v,0);
    const mean = a => sum(a)/a.length;
    const variance = a => {
      const m = mean(a);
      return a.length ? sum(a.map(v => (v-m)*(v-m)))/a.length : NaN; // population variance
    };
    const sd = a => Math.sqrt(variance(a));
    const uniqueSort = a => Array.from(new Set(a)).sort((x,y)=>x-y);

    // All k-combinations of array (without replacement) — returns index combos
    function combinations(arr, k){
      const res = [];
      const n = arr.length;
      if(k===0) return [[]];
      if(k>n) return [];
      const idx = Array.from({length:k}, (_,i)=>i);
      const push = ()=> res.push(idx.map(i => arr[i]));
      push();
      while(true){
        let i = k-1;
        while(i>=0 && idx[i] === n-k+i) i--;
        if(i<0) break;
        idx[i]++;
        for(let j=i+1;j<k;j++) idx[j] = idx[j-1]+1;
        push();
      }
      return res;
    }

    // Discrete bar chart
    function drawDiscreteBar(svgId, values){
      const svg = document.getElementById(svgId);
      const W=640, H=340, pad={l:50,r:10,t:18,b:40};
      svg.innerHTML = '';
      if(!values.length) return;
      const cats = uniqueSort(values);
      const counts = cats.map(c => values.filter(v=>v===c).length);
      const maxCount = Math.max(...counts);

      const innerW = W - pad.l - pad.r;
      const innerH = H - pad.t - pad.b;
      const barW = innerW / cats.length;

      // y grid/ticks
      for(let t=0;t<=maxCount;t++){
        const yTick = pad.t + innerH * (1 - t/maxCount);
        svg.insertAdjacentHTML('beforeend',
          `<line x1="${pad.l-4}" y1="${yTick}" x2="${W-pad.r}" y2="${yTick}" stroke="#e5e7eb" />`+
          `<text x="${pad.l-8}" y="${yTick+4}" font-size="11" text-anchor="end" fill="#6b7280">${t}</text>`
        );
      }

      // bars + x labels
      cats.forEach((c,i)=>{
        const h = innerH * (counts[i]/maxCount);
        const yTop = pad.t + innerH - h;
        const x = pad.l + i*barW + 4;
        svg.insertAdjacentHTML('beforeend',
          `<rect x="${x}" y="${yTop}" width="${Math.max(2,barW-8)}" height="${h}"
                 fill="var(--kctcs-blue)"></rect>`);
        svg.insertAdjacentHTML('beforeend',
          `<text x="${pad.l + i*barW + barW/2}" y="${H-12}" font-size="11" text-anchor="middle" fill="#374151">${String(c)}</text>`);
      });
    }

    // Histogram
    function drawHistogram(svgId, values, w){
      const svg = document.getElementById(svgId);
      const W=640, H=340, pad={l:50,r:10,t:18,b:40};
      svg.innerHTML = '';
      if(!values.length || !isFinite(w) || w<=0) return;

      const minV = Math.min(...values), maxV = Math.max(...values);
      const start = Math.floor(minV/w)*w;
      const end = Math.ceil(maxV/w)*w + 1e-9;
      const bins = [];
      for(let edge=start; edge<end; edge+=w){
        bins.push({x0: edge, x1: edge+w, c:0});
      }
      values.forEach(v=>{
        let b = Math.floor((v - start)/w);
        if(b<0) b=0;
        if(b>=bins.length) b=bins.length-1;
        bins[b].c++;
      });
      const maxC = Math.max(...bins.map(b=>b.c));

      const innerW = W - pad.l - pad.r;
      const innerH = H - pad.t - pad.b;
      const barW = innerW / bins.length;

      for(let t=0;t<=maxC;t++){
        const yTick = pad.t + innerH * (1 - t/maxC);
        svg.insertAdjacentHTML('beforeend',
          `<line x1="${pad.l-4}" y1="${yTick}" x2="${W-pad.r}" y2="${yTick}" stroke="#e5e7eb" />`+
          `<text x="${pad.l-8}" y="${yTick+4}" font-size="11" text-anchor="end" fill="#6b7280">${t}</text>`
        );
      }

      bins.forEach((b,i)=>{
        const h = innerH * (b.c/maxC);
        const yTop = pad.t + innerH - h;
        const x = pad.l + i*barW + 2;
        svg.insertAdjacentHTML('beforeend',
          `<rect x="${x}" y="${yTop}" width="${Math.max(2,barW-4)}" height="${h}"
                 fill="var(--kctcs-gold)" stroke="rgba(0,0,0,.06)"></rect>`);
        const mid = ((b.x0 + b.x1)/2).toFixed(2);
        svg.insertAdjacentHTML('beforeend',
          `<text x="${pad.l + i*barW + barW/2}" y="${H-12}" font-size="11" text-anchor="middle" fill="#374151">${mid}</text>`);
      });
    }

    // ===== App state =====
    const N = 10;
    const defaultPop = [4,6,7,7,8,9,10,10,12,13];
    let pop = defaultPop.slice();
    let n = 3;
    let rowsCache = []; // all rows for table (unfiltered)

    // Build 10 inputs
    const inputsDiv = document.getElementById('inputs');
    for(let i=0;i<N;i++){
      const el = document.createElement('input');
      el.type = 'number';
      el.step = '0.1';
      el.value = pop[i];
      el.dataset.idx = i;
      el.addEventListener('input', ()=>{ pop[+el.dataset.idx] = parseFloat(el.value); });
      inputsDiv.appendChild(el);
    }

    // UI refs
    const NEl = document.getElementById('N');
    const muEl = document.getElementById('mu');
    const sigmaEl = document.getElementById('sigma');
    const nLabel = document.getElementById('nLabel');
    const numSamplesEl = document.getElementById('numSamples');
    const meanXbarEl = document.getElementById('meanXbar');
    const sdXbarEl = document.getElementById('sdXbar');
    const seTheoryEl = document.getElementById('seTheory');
    const popValsEl = document.getElementById('popVals');
    const sortSelect = document.getElementById('sortSelect');
    const findInput = document.getElementById('findInput');
    const tableBody = document.querySelector('#samplesTable tbody');
    const tableNote = document.getElementById('tableNote');

    function refresh(){
      // read inputs
      pop = Array.from(inputsDiv.querySelectorAll('input')).map(i=>parseFloat(i.value)).filter(Number.isFinite);
      if(pop.length!==N) return;

      const mu = mean(pop);
      const sig = sd(pop);
      const binW = parseFloat(document.getElementById('binWidth').value) || 0.5;
      n = Math.max(2, Math.min(N-1, parseInt(document.getElementById('nInput').value)||3));
      nLabel.textContent = n;

      // combinations and samples
      const idx = Array.from({length:N}, (_,i)=>i);
      const combosIdx = combinations(idx, n); // array of index arrays
      const samples = combosIdx.map(c => c.map(i => pop[i]));
      const xbars = samples.map(s => mean(s));

      // Stats
      const mbar = mean(xbars);
      const sdbar = sd(xbars);
      const seTheory = sig/Math.sqrt(n) * Math.sqrt((N-n)/(N-1));

      // Write stats
      NEl.textContent = N;
      muEl.textContent = fmt(mu, 4);
      sigmaEl.textContent = fmt(sig, 4);
      numSamplesEl.textContent = combosIdx.length.toLocaleString();
      meanXbarEl.textContent = fmt(mbar, 4);
      sdXbarEl.textContent = fmt(sdbar, 4);
      seTheoryEl.textContent = fmt(seTheory, 4);
      popValsEl.textContent = '[' + pop.map(v=>fmt(v,2)).join(', ') + ']';

      // Charts
      drawDiscreteBar('popChart', pop);
      drawHistogram('meanChart', xbars, binW);

      // Build table rows cache
      rowsCache = combosIdx.map((c, i) => ({
        index: i+1,
        indices: '[' + c.join(', ') + ']',
        sample: '[' + c.map(j => fmt(pop[j], 3)).join(', ') + ']',
        mean: mean(samples[i])
      }));

      renderTable();
    }

    function renderTable(){
      // filter
      const q = findInput.value.trim().toLowerCase();
      let rows = rowsCache.slice();
      if(q){
        rows = rows.filter(r =>
          r.indices.toLowerCase().includes(q) ||
          r.sample.toLowerCase().includes(q) ||
          fmt(r.mean, 6).includes(q)
        );
      }
      // sort
      const how = sortSelect.value;
      if(how === 'meanAsc') rows.sort((a,b)=> a.mean - b.mean || a.index - b.index);
      else if(how === 'meanDesc') rows.sort((a,b)=> b.mean - a.mean || a.index - b.index);
      else rows.sort((a,b)=> a.index - b.index);

      // render
      tableBody.innerHTML = rows.map(r => `
        <tr>
          <td class="nowrap">${r.index}</td>
          <td class="mono">${r.indices}</td>
          <td class="mono">${r.sample}</td>
          <td class="nowrap">${fmt(r.mean, 4)}</td>
        </tr>
      `).join('');

      const total = rowsCache.length;
      const shown = rows.length;
      tableNote.textContent = shown===total
        ? `Showing all ${total.toLocaleString()} samples.`
        : `Showing ${shown.toLocaleString()} of ${total.toLocaleString()} samples (filtered).`;
    }

    // Controls
    document.getElementById('btnUpdate').addEventListener('click', refresh);
    document.getElementById('btnRandom').addEventListener('click', ()=>{
      const r = Array.from({length:N}, ()=> Math.round(1 + Math.random()*19)).sort((a,b)=>a-b);
      inputsDiv.querySelectorAll('input').forEach((el,i)=>{ el.value = r[i]; });
      refresh();
    });
    document.getElementById('btnEven').addEventListener('click', ()=>{
      const a=5, b=25, step=(b-a)/(N-1);
      const r = Array.from({length:N}, (_,i)=> +(a + i*step).toFixed(2));
      inputsDiv.querySelectorAll('input').forEach((el,i)=>{ el.value = r[i]; });
      refresh();
    });
    document.getElementById('btnReset').addEventListener('click', ()=>{
      inputsDiv.querySelectorAll('input').forEach((el,i)=>{ el.value = defaultPop[i]; });
      document.getElementById('nInput').value = 3;
      document.getElementById('binWidth').value = 0.5;
      refresh();
    });

    sortSelect.addEventListener('change', renderTable);
    findInput.addEventListener('input', renderTable);
    document.getElementById('nInput').addEventListener('input', refresh);
    document.getElementById('binWidth').addEventListener('input', refresh);

    // First draw
    refresh();
  </script>
</body>
</html>

